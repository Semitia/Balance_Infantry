#ifndef _MOTOR_RS485_H
#define _MOTOR_RS485_H

#include <stm32f4xx.h>
#include <stm32f4xx_conf.h>
#include <string.h>
#include <stdint.h>
#include <math.h>
#include <stdio.h>
#include <stdlib.h>

#include "crc32.h"
#include "UniTreeA1.h"
#include "debug.h"

#define A1MOTOR_RECVBUF_SIZE sizeof(ServoComdDataV3)
#define SEND_TO_A1MOTOR_BUFF_SIZE sizeof(MasterComdDataV3)

/* MOTOR1 */
#define MOTOR1_RS485_GPIOx_CLOCK_CMD RCC_AHB1PeriphClockCmd
#define MOTOR1_RS485_RCC_AxBxPeriph_GPIOx RCC_AHB1Periph_GPIOA
#define MOTOR1_RS485_UARTx_CLOCK_CMD RCC_APB2PeriphClockCmd
#define MOTOR1_RS485_RCC_AxBxPeriph_UARTx RCC_APB2Periph_USART1
#define MOTOR1_RS485_GPIOx GPIOA
#define MOTOR1_RS485_UARTx USART1
#define MOTOR1_RS485_GPIO_AF_USARTx GPIO_AF_USART1
#define MOTOR1_RS485_GPIO_PinSourcex1 GPIO_PinSource9
#define MOTOR1_RS485_GPIO_PinSourcex2 GPIO_PinSource10
#define MOTOR1_RS485_GPIO_Pin_x1 GPIO_Pin_9
#define MOTOR1_RS485_GPIO_Pin_x2 GPIO_Pin_10
#define MOTOR1_RS485_BaudRate 4800000

#define MOTOR1_RS485_RECV_USARTx_IRQHandler USART1_IRQHandler
#define MOTOR1_RS485_RECV_USARTx_IRQn USART1_IRQn

#define MOTOR1_RS485_RECV_DMAx_Streamx_IRQn DMA2_Stream5_IRQn
#define MOTOR1_RS485_RECV_DMAx_Streamx DMA2_Stream5
#define MOTOR1_RS485_RECV_RCC_AxBxPeriphClockCmd RCC_AHB1PeriphClockCmd
#define MOTOR1_RS485_RECV_RCC_AxBxPeriph_DMAx RCC_AHB1Periph_DMA2
#define MOTOR1_RS485_RECV_DMA_Channel_x DMA_Channel_4
#define MOTOR1_RS485_RECV_DMAx_Streamx_IRQHandler DMA2_Stream5_IRQHandler
#define MOTOR1_RS485_RECV_DMA_FLAG_TCIFx DMA_FLAG_TCIF5
#define MOTOR1_RS485_RECV_DMA_IT_TCIFx DMA_IT_TCIF5

#define MOTOR1_RS485_SEND_DMAx_Streamx_IRQn DMA2_Stream7_IRQn
#define MOTOR1_RS485_SEND_DMAx_Streamx DMA2_Stream7
#define MOTOR1_RS485_SEND_RCC_AxBxPeriphClockCmd RCC_AHB1PeriphClockCmd
#define MOTOR1_RS485_SEND_RCC_AxBxPeriph_DMAx RCC_AHB1Periph_DMA2
#define MOTOR1_RS485_SEND_DMA_Channel_x DMA_Channel_4
#define MOTOR1_RS485_SEND_DMAx_Streamx_IRQHandler DMA2_Stream7_IRQHandler
#define MOTOR1_RS485_SEND_DMA_FLAG_TCIFx DMA_FLAG_TCIF7
#define MOTOR1_RS485_SEND_DMA_IT_TCIFx DMA_IT_TCIF7

// MOTOR1 控制端口
#define MOTOR1_CONTROL_GPIOx_CLOCK_CMD RCC_AHB1PeriphClockCmd
#define MOTOR1_CONTROL_RCC_AxBxPeriph_GPIOx RCC_AHB1Periph_GPIOA
#define MOTOR1_RS485_RE_PIN GPIO_Pin_8
#define MOTOR1_RS485_RE_GPIO_PORT GPIOA
#define MOTOR1_START_READ() GPIO_ResetBits(MOTOR1_RS485_RE_GPIO_PORT, MOTOR1_RS485_RE_PIN)
#define MOTOR1_START_WRITE() GPIO_SetBits(MOTOR1_RS485_RE_GPIO_PORT, MOTOR1_RS485_RE_PIN)

/*  MOTOR2  */
#define MOTOR2_RS485_GPIOx_CLOCK_CMD RCC_AHB1PeriphClockCmd
#define MOTOR2_RS485_RCC_AxBxPeriph_GPIOx RCC_AHB1Periph_GPIOC
#define MOTOR2_RS485_UARTx_CLOCK_CMD RCC_APB2PeriphClockCmd
#define MOTOR2_RS485_RCC_AxBxPeriph_UARTx RCC_APB2Periph_USART6
#define MOTOR2_RS485_GPIOx GPIOC
#define MOTOR2_RS485_UARTx USART6
#define MOTOR2_RS485_GPIO_AF_USARTx GPIO_AF_USART6
#define MOTOR2_RS485_GPIO_PinSourcex1 GPIO_PinSource6
#define MOTOR2_RS485_GPIO_PinSourcex2 GPIO_PinSource7
#define MOTOR2_RS485_GPIO_Pin_x1 GPIO_Pin_6
#define MOTOR2_RS485_GPIO_Pin_x2 GPIO_Pin_7
#define MOTOR2_RS485_BaudRate 4800000

#define MOTOR2_RS485_RECV_DMAx_Streamx_IRQn DMA2_Stream1_IRQn
#define MOTOR2_RS485_RECV_DMAx_Streamx DMA2_Stream1
#define MOTOR2_RS485_RECV_RCC_AxBxPeriphClockCmd RCC_AHB1PeriphClockCmd
#define MOTOR2_RS485_RECV_RCC_AxBxPeriph_DMAx RCC_AHB1Periph_DMA2
#define MOTOR2_RS485_RECV_DMA_Channel_x DMA_Channel_5
#define MOTOR2_RS485_RECV_DMAx_Streamx_IRQHandler DMA2_Stream1_IRQHandler
#define MOTOR2_RS485_RECV_DMA_FLAG_TCIFx DMA_FLAG_TCIF1
#define MOTOR2_RS485_RECV_DMA_IT_TCIFx DMA_IT_TCIF1

#define MOTOR2_RS485_RECV_USARTx_IRQHandler USART6_IRQHandler
#define MOTOR2_RS485_RECV_USARTx_IRQn USART6_IRQn

#define MOTOR2_RS485_SEND_DMAx_Streamx_IRQn DMA2_Stream6_IRQn
#define MOTOR2_RS485_SEND_DMAx_Streamx DMA2_Stream6
#define MOTOR2_RS485_SEND_RCC_AxBxPeriphClockCmd RCC_AHB1PeriphClockCmd
#define MOTOR2_RS485_SEND_RCC_AxBxPeriph_DMAx RCC_AHB1Periph_DMA2
#define MOTOR2_RS485_SEND_DMA_Channel_x DMA_Channel_5
#define MOTOR2_RS485_SEND_DMAx_Streamx_IRQHandler DMA2_Stream6_IRQHandler
#define MOTOR2_RS485_SEND_DMA_FLAG_TCIFx DMA_FLAG_TCIF6
#define MOTOR2_RS485_SEND_DMA_IT_TCIFx DMA_IT_TCIF6

// MOTOR2 控制端口
#define MOTOR2_CONTROL_GPIOx_CLOCK_CMD RCC_AHB1PeriphClockCmd
#define MOTOR2_CONTROL_RCC_AxBxPeriph_GPIOx RCC_AHB1Periph_GPIOB
#define MOTOR2_RS485_RE_PIN GPIO_Pin_15
#define MOTOR2_RS485_RE_GPIO_PORT GPIOB
#define MOTOR2_START_READ() GPIO_ResetBits(MOTOR2_RS485_RE_GPIO_PORT, MOTOR2_RS485_RE_PIN)
#define MOTOR2_START_WRITE() GPIO_SetBits(MOTOR2_RS485_RE_GPIO_PORT, MOTOR2_RS485_RE_PIN)

void MOTOR1_RS485_Configuration(void);
void MOTOR2_RS485_Configuration(void);

extern uint8_t A1Motorbuffer[2][A1MOTOR_RECVBUF_SIZE];
extern uint8_t SendToA1Motor_Buff[2][SEND_TO_A1MOTOR_BUFF_SIZE];

#endif // !_MOTOR_RS485_H
